<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão Administrativa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Nunito', sans-serif; background-color: #f3f4f6; color: #1e293b; } 
        .tab-btn { transition: all 0.2s; position: relative; cursor: pointer; }
        .tab-btn.active { color: #2563eb; background-color: #eff6ff; }
        .tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background-color: #2563eb; border-radius: 3px 3px 0 0; }
        .tab-btn:not(.active) { color: #64748b; }
        .tab-btn:not(.active):hover { color: #334155; background-color: #f8fafc; }
        .sub-tab-btn { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .sub-tab-btn.active { color: #2563eb; border-bottom-color: #2563eb; background-color: #eff6ff; }
        .sub-tab-btn:not(.active) { color: #64748b; }
        .sub-tab-btn:not(.active):hover { color: #334155; background-color: #f8fafc; }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-100">
    <script src="js/config.js"></script>
    <script src="js/importacao.js"></script> 
    <script src="js/gestao/main.js" defer></script>
    <script src="js/gestao/equipe.js" defer></script>
    <script src="js/gestao/empresas.js" defer></script>
    <script src="js/gestao/producao.js" defer></script>
    <script src="js/gestao/assertividade.js" defer></script>

    <div class="bg-white border-b border-slate-200 sticky top-0 z-40 shadow-sm">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row items-center justify-between h-14 gap-2">
                <div class="flex items-center gap-3">
                    <i class="fas fa-cogs text-slate-400 text-lg"></i>
                    <h1 class="text-lg font-black text-slate-700 tracking-tight">Gestão</h1>
                </div>
                <div class="flex items-center gap-1 overflow-x-auto">
                    <button onclick="Gestao.mudarAba('equipe')" id="btn-equipe" class="tab-btn active px-4 py-3 text-sm font-bold flex items-center gap-2"><i class="fas fa-users"></i> Equipe</button>
                    <button onclick="Gestao.mudarAba('producao')" id="btn-producao" class="tab-btn px-4 py-3 text-sm font-bold flex items-center gap-2"><i class="fas fa-chart-line"></i> Prod. Individual</button>
                    <button onclick="Gestao.mudarAba('assertividade')" id="btn-assertividade" class="tab-btn px-4 py-3 text-sm font-bold flex items-center gap-2"><i class="fas fa-bullseye"></i> Assertividade</button>
                    <button onclick="Gestao.mudarAba('empresas')" id="btn-empresas" class="tab-btn px-4 py-3 text-sm font-bold flex items-center gap-2"><i class="fas fa-building"></i> Empresas</button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-6">
        
        <div id="tab-equipe" class="view-section animate-fade-in space-y-6">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden min-h-[600px] flex flex-col">
                <div class="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                    <div class="relative w-64">
                        <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                        <input type="text" id="search-user" onkeyup="Gestao.Equipe.filtrar()" placeholder="Buscar..." class="w-full pl-10 p-2.5 rounded-lg border border-slate-300 text-sm outline-none focus:border-blue-500">
                    </div>
                    <div class="flex gap-2">
                        <input type="file" id="input-import-users" accept=".xlsx, .csv" class="hidden" onchange="Gestao.Equipe.importar(this)">
                        <button onclick="document.getElementById('input-import-users').click()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm"><i class="fas fa-file-excel mr-1"></i> Importar</button>
                        <button onclick="Gestao.Equipe.abrirModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm"><i class="fas fa-plus mr-1"></i> Novo</button>
                    </div>
                </div>
                <div class="flex border-b border-slate-200">
                    <button onclick="Gestao.Equipe.mudarFiltro('ativos')" id="btn-sub-ativos" class="sub-tab-btn active flex-1 py-2 text-sm font-bold text-center text-emerald-600">Ativos (<span id="count-ativos">0</span>)</button>
                    <button onclick="Gestao.Equipe.mudarFiltro('inativos')" id="btn-sub-inativos" class="sub-tab-btn flex-1 py-2 text-sm font-bold text-center text-red-600">Inativos (<span id="count-inativos">0</span>)</button>
                </div>
                <div class="overflow-y-auto flex-1 p-2 space-y-2 bg-slate-50/50" id="user-list"></div>
            </div>
        </div>

        <div id="tab-empresas" class="view-section hidden animate-fade-in space-y-6">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden min-h-[600px] flex flex-col">
                <div class="p-4 border-b border-slate-100 bg-slate-50 flex justify-between items-center">
                    <div class="relative w-64">
                        <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                        <input type="text" id="search-empresa" onkeyup="Gestao.Empresas.filtrar()" placeholder="Buscar empresa..." class="w-full pl-10 p-2.5 rounded-lg border border-slate-300 text-sm outline-none focus:border-blue-500">
                    </div>
                    <div class="flex gap-2">
                        <input type="file" id="input-import-empresas" accept=".xlsx, .csv" class="hidden" onchange="Gestao.Empresas.importar(this)">
                        <button onclick="document.getElementById('input-import-empresas').click()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm"><i class="fas fa-file-excel mr-1"></i> Importar</button>
                        <button onclick="Gestao.Empresas.abrirModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm"><i class="fas fa-plus mr-1"></i> Nova</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-50 text-slate-500 font-bold uppercase text-xs">
                            <tr>
                                <th class="px-6 py-3 w-24">ID</th>
                                <th class="px-6 py-3">Nome</th>
                                <th class="px-6 py-3">Subdomínio</th>
                                <th class="px-6 py-3 text-center">Entrada</th>
                                <th class="px-6 py-3">Obs</th>
                                <th class="px-6 py-3 text-center w-24">Ações</th>
                            </tr>
                        </thead>
                        <tbody id="lista-empresas" class="divide-y divide-slate-100 bg-white"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-producao" class="view-section hidden animate-fade-in space-y-6">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 max-w-4xl mx-auto">
                <h2 class="font-bold text-slate-700 mb-4"><i class="fas fa-chart-line text-blue-600"></i> Metas de Produção</h2>
                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <label class="block text-xs font-bold text-slate-500 uppercase">Colaborador</label>
                        <select id="meta-user" onchange="Gestao.Producao.carregar()" class="w-full p-2 border rounded font-bold text-slate-700"><option>Carregando...</option></select>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block text-xs font-bold text-slate-500 uppercase">Data</label><input type="date" id="meta-date" class="w-full p-2 border rounded"></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase">Meta</label><input type="number" id="meta-value" class="w-full p-2 border rounded" placeholder="650"></div>
                        </div>
                        <button onclick="Gestao.Producao.salvar()" class="w-full bg-blue-600 text-white font-bold py-2 rounded">Gravar</button>
                    </div>
                    <div class="border-l pl-4"><h4 class="font-bold text-sm text-slate-600 mb-2">Histórico</h4><div id="meta-list" class="text-xs text-slate-400">Selecione um usuário.</div></div>
                </div>
            </div>
        </div>

        <div id="tab-assertividade" class="view-section hidden animate-fade-in space-y-6">
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 max-w-4xl mx-auto">
                <h2 class="font-bold text-slate-700 mb-4"><i class="fas fa-bullseye text-purple-600"></i> Meta Global Assertividade</h2>
                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="block text-xs font-bold text-slate-500 uppercase">Data</label><input type="date" id="assert-date" class="w-full p-2 border rounded"></div>
                            <div><label class="block text-xs font-bold text-slate-500 uppercase">Min (%)</label><input type="number" id="assert-value" class="w-full p-2 border rounded" placeholder="97"></div>
                        </div>
                        <button onclick="Gestao.Assertividade.salvar()" class="w-full bg-purple-600 text-white font-bold py-2 rounded">Gravar Global</button>
                    </div>
                    <div class="border-l pl-4"><h4 class="font-bold text-sm text-slate-600 mb-2">Histórico</h4><div id="assert-list" class="text-xs text-slate-400">Carregando...</div></div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-user" class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden">
            <div class="bg-slate-50 p-4 border-b flex justify-between items-center"><h3 id="modal-user-title" class="font-bold text-slate-800">Colaborador</h3><button onclick="Gestao.fecharModais()" class="text-2xl">&times;</button></div>
            <div class="p-6 space-y-3">
                <input type="number" id="form-user-id" class="w-full p-2 border rounded" placeholder="ID (Login)">
                <input type="text" id="form-user-nome" class="w-full p-2 border rounded" placeholder="Nome Completo">
                <input type="text" id="form-user-senha" class="w-full p-2 border rounded" placeholder="Senha">
                <div class="grid grid-cols-2 gap-3">
                    <select id="form-user-funcao" class="w-full p-2 border rounded"><option value="Assistente">Assistente</option><option value="Gestora">Gestora</option><option value="Auditora">Auditora</option></select>
                    <select id="form-user-contrato" class="w-full p-2 border rounded"><option value="PJ">PJ</option><option value="CLT">CLT</option><option value="FINALIZADO" class="text-red-500 font-bold">FINALIZADO</option></select>
                </div>
                <select id="form-user-ativo" class="w-full p-2 border rounded font-bold"><option value="true" class="text-green-600">ATIVO</option><option value="false" class="text-red-600">INATIVO</option></select>
                <div class="flex gap-2 pt-2"><button onclick="Gestao.Equipe.salvar()" class="flex-1 bg-blue-600 text-white py-2 rounded font-bold">Salvar</button><button onclick="Gestao.Equipe.excluir()" id="btn-user-delete" class="hidden text-red-500 font-bold px-3">Excluir</button></div>
            </div>
        </div>
    </div>

    <div id="modal-empresa" class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg overflow-hidden">
            <div class="bg-slate-50 p-4 border-b flex justify-between items-center"><h3 id="modal-empresa-title" class="font-bold text-slate-800">Empresa</h3><button onclick="Gestao.fecharModais()" class="text-2xl">&times;</button></div>
            <div class="p-6 space-y-3">
                <input type="hidden" id="form-empresa-uid">
                <div class="grid grid-cols-3 gap-3">
                    <input type="number" id="form-empresa-id" class="col-span-1 p-2 border rounded" placeholder="ID">
                    <input type="date" id="form-empresa-data" class="col-span-2 p-2 border rounded">
                </div>
                <input type="text" id="form-empresa-nome" class="w-full p-2 border rounded" placeholder="Nome">
                <input type="text" id="form-empresa-sub" class="w-full p-2 border rounded" placeholder="Subdomínio">
                <textarea id="form-empresa-obs" class="w-full p-2 border rounded" rows="2" placeholder="Observações"></textarea>
                <div class="flex gap-2 pt-2"><button onclick="Gestao.Empresas.salvar()" class="flex-1 bg-blue-600 text-white py-2 rounded font-bold">Salvar</button><button onclick="Gestao.Empresas.excluir()" id="btn-empresa-delete" class="hidden text-red-500 font-bold px-3">Excluir</button></div>
            </div>
        </div>
    </div>
</body>
</html>