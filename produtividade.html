<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Produtividade</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style> 
        body { font-family: 'Nunito', sans-serif; background-color: #f3f4f6; } 
        
        /* Navegação */
        .tab-btn { transition: all 0.2s; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: #2563eb; border-color: #2563eb; background-color: #eff6ff; }
        .tab-btn:not(.active) { color: #64748b; }
        .tab-btn:not(.active):hover { color: #334155; background-color: #f8fafc; }
        
        /* Tabelas */
        .selected-row { background-color: #eff6ff !important; border-left: 4px solid #2563eb; }
        .me-row { background-color: #f8fafc; border-left: 4px solid #94a3b8; }
        .col-tri { background-color: #f0f9ff; color: #0369a1; font-weight: bold; text-align: center; border-left: 1px solid #e0f2fe; }
        .col-sem { background-color: #e0f2fe; color: #075985; font-weight: 800; text-align: center; border-left: 2px solid #bae6fd; }
        .col-ano { background-color: #0f172a; color: #ffffff; font-weight: 800; text-align: center; border-left: 2px solid #cbd5e1; }
        .row-total td { background-color: #eff6ff !important; font-weight: 800; color: #1e40af; border-top: 2px solid #bfdbfe; }
        .col-fixed { position: sticky; left: 0; background: white; z-index: 10; border-right: 1px solid #e2e8f0; }
        
        /* Animações */
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Seletor de Fator (100%, 50%, 0%) */
        .status-select { 
            background: transparent; font-weight: bold; font-size: 0.75rem; 
            padding: 2px 6px; border-radius: 6px; cursor: pointer; outline: none;
            transition: all 0.2s;
        }
        /* Cores do Seletor */
        .st-1 { color: #15803d; background-color: #dcfce7; border: 1px solid #86efac; } /* 100% Verde */
        .st-05 { color: #a16207; background-color: #fef9c3; border: 1px solid #fde047; } /* 50% Amarelo */
        .st-0 { color: #b91c1c; background-color: #fee2e2; border: 1px solid #fca5a5; } /* 0% Vermelho */
        
        /* Linha inativa (0%) fica opaca */
        .row-ignored { opacity: 0.6; background-color: #f8fafc; filter: grayscale(0.8); }
    </style>
</head>
<body class="text-slate-800">
    <script src="js/config.js"></script>
    <script src="js/sistema.js"></script> 
    <script src="js/layout.js"></script>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <div class="flex flex-col md:flex-row justify-between items-end mb-6 gap-4">
            <div>
                <h1 class="text-2xl font-black text-slate-800 tracking-tight">Painel de Gestão</h1>
                <p class="text-slate-500 text-sm font-medium">Controle de produtividade e validação.</p>
            </div>
            
            <div class="bg-white p-1.5 rounded-xl border border-slate-200 shadow-sm flex overflow-x-auto max-w-full">
                <button onclick="mudarAba('geral')" id="btn-geral" class="tab-btn active px-4 py-2 text-sm font-bold rounded-lg flex items-center gap-2">
                    <i class="fas fa-check-circle"></i> Validação Diária
                </button>
                <button onclick="mudarAba('performance')" id="btn-performance" class="tab-btn px-4 py-2 text-sm font-bold rounded-lg flex items-center gap-2">
                    <i class="fas fa-trophy"></i> Performance
                </button>
                <button onclick="mudarAba('matriz')" id="btn-matriz" class="tab-btn px-4 py-2 text-sm font-bold rounded-lg flex items-center gap-2">
                    <i class="fas fa-th"></i> Matriz Anual
                </button>
                <button onclick="mudarAba('consolidado')" id="btn-consolidado" class="tab-btn px-4 py-2 text-sm font-bold rounded-lg flex items-center gap-2">
                    <i class="fas fa-table"></i> Consolidado
                </button>
            </div>
        </div>

        <div id="tab-geral" class="view-section animate-fade-in space-y-6">
            
            <div class="flex flex-wrap items-center justify-between gap-3 bg-white p-3 rounded-xl shadow-sm border border-slate-200">
                <div>
                    <input type="file" id="input-excel" accept=".xlsx, .csv" class="hidden" onchange="importarExcel(this)">
                    <button onclick="document.getElementById('input-excel').click()" class="bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-sm transition flex items-center gap-2">
                        <i class="fas fa-file-excel"></i> Importar Excel
                    </button>
                    <span class="text-[10px] text-slate-400 block mt-1 ml-1">Arquivo: ddmmaaaa.xlsx</span>
                </div>

                <div class="flex items-center gap-3">
                    <div class="flex items-center gap-2 bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-100">
                        <span class="text-[10px] font-bold text-blue-500 uppercase tracking-wider">Ref</span>
                        <input type="text" id="data-validacao" class="w-24 bg-transparent text-center font-bold text-slate-700 outline-none text-sm cursor-pointer" placeholder="DD/MM/AAAA" maxlength="10">
                        <i class="fas fa-calendar-alt text-slate-400"></i>
                    </div>
                    
                    <select id="view-mode" onchange="Geral.toggleSemana()" class="py-1.5 px-3 border border-slate-200 rounded-lg text-sm font-bold text-slate-600 outline-none bg-slate-50 focus:border-blue-500 cursor-pointer">
                        <option value="dia">Apenas o Dia</option>
                        <option value="mes">Mês Inteiro</option>
                        <option value="semana">Por Semana</option>
                    </select>

                    <select id="select-semana" onchange="Geral.carregarTela()" class="hidden py-1.5 px-3 border border-blue-200 bg-blue-50 text-blue-800 rounded-lg text-sm font-bold outline-none cursor-pointer">
                        <option value="1">Semana 1</option><option value="2">Semana 2</option><option value="3">Semana 3</option><option value="4">Semana 4</option><option value="5">Semana 5</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 group relative">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Equipe Considerada</p>
                    <div class="flex items-end justify-between">
                        <p class="text-3xl font-black text-slate-800 tracking-tighter" id="kpi-hc">--</p>
                        <i class="fas fa-users text-4xl text-slate-100 group-hover:text-blue-50 transition"></i>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-1">Assistentes c/ Produção</p>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 group relative">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Dias Trab. (Soma)</p>
                    <div class="flex items-end justify-between">
                        <p class="text-3xl font-black text-slate-800 tracking-tighter" id="kpi-dias">--</p>
                        <i class="fas fa-calendar-day text-4xl text-slate-100 group-hover:text-blue-50 transition"></i>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-1" id="kpi-dias-label">Considera meio período</p>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 group relative">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Produção Total</p>
                    <div class="flex items-end gap-2">
                        <p class="text-3xl font-black text-blue-600 tracking-tighter" id="kpi-total">--</p>
                        <span class="text-xs font-bold text-slate-400 mb-1">/ <span id="kpi-meta-total">--</span></span>
                    </div>
                    <div class="w-full bg-slate-100 h-1.5 mt-2 rounded-full overflow-hidden">
                        <div id="bar-prod" class="bg-blue-500 h-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-1 text-right">Realizado vs Meta Ajustada</p>
                </div>

                <div class="bg-white p-5 rounded-xl shadow-sm border border-slate-200 group relative">
                    <p class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-1">Média Diária</p>
                    <div class="flex items-end gap-2">
                        <p class="text-3xl font-black text-emerald-600 tracking-tighter" id="kpi-media">--</p>
                        <span class="text-xs font-bold text-slate-400 mb-1">/ <span id="kpi-meta-media">--</span></span>
                    </div>
                    <div class="w-full bg-slate-100 h-1.5 mt-2 rounded-full overflow-hidden">
                        <div id="bar-media" class="bg-emerald-500 h-full transition-all duration-500" style="width: 0%"></div>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-1 text-right">Média Real vs Esperada</p>
                </div>
            </div>

            <div id="selection-header" class="hidden bg-blue-50 border border-blue-100 p-3 rounded-lg flex justify-between items-center animate-fade-in">
                <span class="text-sm font-bold text-blue-800">
                    <i class="fas fa-user-circle mr-2"></i> Exibindo dados de: <span id="selected-name" class="underline text-blue-900"></span>
                </span>
                <button onclick="Geral.limparSelecao()" class="text-xs bg-white border border-blue-200 text-blue-600 px-3 py-1 rounded hover:bg-blue-100 font-bold shadow-sm">
                    <i class="fas fa-times mr-1"></i> Limpar Filtro
                </button>
            </div>

            <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-slate-50 text-slate-500 font-bold uppercase text-xs tracking-wide">
                            <tr>
                                <th class="px-4 py-4 text-center w-24">Fator</th>
                                <th class="px-6 py-4">Assistente</th>
                                <th class="px-6 py-4 text-center">Dias Calc.</th>
                                <th class="px-6 py-4 text-center">Total</th>
                                <th class="px-6 py-4 text-center">FIFO</th>
                                <th class="px-6 py-4 text-center">G. Total</th>
                                <th class="px-6 py-4 text-center">G. Parcial</th>
                                <th class="px-6 py-4 text-center">Meta Calc.</th>
                                <th class="px-6 py-4 text-center">Status</th>
                            </tr>
                        </thead>
                        <tbody id="tabela-corpo" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-performance" class="view-section hidden animate-fade-in space-y-6">
            <div class="flex justify-end p-3 bg-white rounded-xl shadow-sm border border-slate-200">
                <div class="flex items-center gap-2">
                    <input type="text" id="data-perf" class="w-24 bg-slate-50 text-center font-bold text-slate-700 outline-none text-sm p-1 rounded border border-slate-100" placeholder="DD/MM/AAAA" maxlength="10">
                    <select id="perf-period-type" onchange="Perf.carregarRanking()" class="text-sm font-bold text-slate-600 bg-transparent outline-none cursor-pointer"><option value="mes">Mensal</option><option value="ano">Anual</option></select>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                <table class="w-full text-sm text-left"><tbody id="perf-ranking-body"></tbody></table>
            </div>
        </div>

        <div id="tab-matriz" class="view-section hidden animate-fade-in space-y-6">
            <div class="flex justify-between p-3 bg-white rounded-xl shadow-sm border border-slate-200">
                <h3 class="font-bold">Matriz Anual</h3>
                <input type="text" id="data-matriz" class="w-24 bg-slate-50 text-center font-bold text-slate-700 outline-none text-sm p-1 rounded border border-slate-100" placeholder="DD/MM/AAAA" maxlength="10">
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full text-xs text-left"><tbody id="matriz-body"></tbody></table></div></div>
        </div>

        <div id="tab-consolidado" class="view-section hidden animate-fade-in space-y-6">
            <div class="flex justify-end p-3 bg-white rounded-xl shadow-sm border border-slate-200 gap-2">
                <input type="text" id="data-cons" class="w-24 bg-slate-50 text-center font-bold text-slate-700 outline-none text-sm p-1 rounded border border-slate-100" placeholder="DD/MM/AAAA" maxlength="10">
                <select id="cons-period-type" onchange="Cons.carregar()" class="text-sm font-bold text-slate-600 bg-transparent outline-none cursor-pointer"><option value="mes">Mensal</option><option value="ano_mes">Anual</option></select>
            </div>
            <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden"><div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead id="cons-table-header"></thead><tbody id="cons-table-body"></tbody></table></div></div>
        </div>
    </div>

    <script>
        const sessao = JSON.parse(localStorage.getItem('usuario'));
        const KEY_DATA_GLOBAL = 'data_sistema_global';

        // --- SISTEMA DE NAVEGAÇÃO ENTRE ABAS ---
        function mudarAba(aba) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${aba}`).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${aba}`).classList.add('active');

            const dataAtual = localStorage.getItem(KEY_DATA_GLOBAL) || Sistema.Datas.formatar(new Date());
            
            // Sincroniza a data e carrega a aba específica
            if (aba === 'geral') { document.getElementById('data-validacao').value = dataAtual; Geral.carregarTela(); }
            if (aba === 'performance') { document.getElementById('data-perf').value = dataAtual; Perf.init(); }
            if (aba === 'matriz') { document.getElementById('data-matriz').value = dataAtual; Matriz.init(); }
            if (aba === 'consolidado') { document.getElementById('data-cons').value = dataAtual; Cons.init(); }
        }

        // --- FUNÇÃO DE IMPORTAÇÃO DE EXCEL ---
        async function importarExcel(input) {
            const file = input.files[0];
            if (!file) return;

            // Extrai data do nome do arquivo (31122025.xlsx)
            const nomeArquivo = file.name;
            const matchData = nomeArquivo.match(/^(\d{2})(\d{2})(\d{4})/);
            if (!matchData) { alert("Nome inválido. Formato deve ser ddmmaaaa.xlsx"); input.value = ''; return; }
            const dataDoArquivo = `${matchData[3]}-${matchData[2]}-${matchData[1]}`;

            const reader = new FileReader();
            reader.onload = async (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheet = workbook.Sheets[workbook.SheetNames[0]];
                    const json = XLSX.utils.sheet_to_json(sheet);

                    if (json.length === 0) return alert("Planilha vazia.");

                    // Mapa de Usuários
                    const usersMap = {};
                    const { data: users } = await _supabase.from('usuarios').select('id, nome');
                    users.forEach(u => usersMap[u.nome.trim().toLowerCase()] = u.id);

                    let inserts = [];
                    for (let row of json) {
                        const nomeCsv = row['assistente'];
                        const idCsv = row['id_assistente'];
                        
                        if (!idCsv && !nomeCsv) continue;
                        if (String(nomeCsv).toLowerCase().includes('total')) continue;

                        let uid = idCsv;
                        if (!uid && nomeCsv && usersMap[nomeCsv.trim().toLowerCase()]) {
                            uid = usersMap[nomeCsv.trim().toLowerCase()];
                        }

                        if (uid) {
                            inserts.push({
                                usuario_id: uid,
                                data_referencia: dataDoArquivo,
                                quantidade: row['documentos_validados'] || 0,
                                fifo: row['documentos_validados_fifo'] || 0,
                                gradual_total: row['documentos_validados_gradual_total'] || 0,
                                gradual_parcial: row['documentos_validados_gradual_parcial'] || 0,
                                perfil_fc: row['documentos_validados_perfil_fc'] || 0
                            });
                        }
                    }

                    if (inserts.length > 0) {
                        if(confirm(`Importar ${inserts.length} registros para ${matchData[1]}/${matchData[2]}/${matchData[3]}?`)) {
                            // Constraint deve estar ativa no banco (usuario_id, data_referencia UNIQUE)
                            const { error } = await _supabase.from('producao').upsert(inserts, { onConflict: 'usuario_id, data_referencia' });
                            if (error) throw error;
                            
                            alert("Importação realizada com sucesso!");
                            localStorage.setItem(KEY_DATA_GLOBAL, `${matchData[1]}/${matchData[2]}/${matchData[3]}`);
                            mudarAba('geral');
                        }
                    } else {
                        alert("Nenhum dado válido encontrado.");
                    }
                } catch (err) { console.error(err); alert("Erro ao importar: " + err.message); } finally { input.value = ''; }
            };
            reader.readAsArrayBuffer(file);
        }

        // --- MÓDULO GERAL (Validação Diária) ---
        const Geral = {
            listaAtual: [],
            selecionado: null,
            dataVisualizada: null, // Para saber onde salvar o fator

            toggleSemana: function() {
                const mode = document.getElementById('view-mode').value;
                const selSemana = document.getElementById('select-semana');
                if (mode === 'semana') selSemana.classList.remove('hidden'); else selSemana.classList.add('hidden');
                this.carregarTela();
            },
            
            carregarTela: async function() {
                const modo = document.getElementById('view-mode').value;
                const refDate = Sistema.Datas.lerInput('data-validacao');
                const isoDate = refDate.toISOString().split('T')[0];
                this.dataVisualizada = isoDate; // Salva para o fator

                let inicio, fim;
                if (modo === 'dia') { 
                    inicio = isoDate; fim = isoDate; 
                } else { 
                    const ano = refDate.getFullYear(); const mes = refDate.getMonth();
                    inicio = new Date(ano, mes, 1).toISOString().split('T')[0];
                    fim = new Date(ano, mes + 1, 0).toISOString().split('T')[0];
                }

                const { data } = await _supabase.from('producao').select('*').gte('data_referencia', inicio).lte('data_referencia', fim);
                let dadosFiltrados = data || [];
                if (modo === 'semana') {
                    const numSemana = parseInt(document.getElementById('select-semana').value);
                    dadosFiltrados = dadosFiltrados.filter(d => Sistema.Datas.getSemanaDoMes(d.data_referencia) === numSemana);
                }

                this.listaAtual = Sistema.Dados.normalizar(dadosFiltrados);
                this.renderizar();
            },

            // --- Lógica do Seletor de Fator ---
            mudarFator: function(nome, valor) {
                const modo = document.getElementById('view-mode').value;
                if (modo !== 'dia') {
                    alert("Atenção: Altere o fator apenas visualizando o 'Dia' específico para evitar erros de data.");
                    this.renderizar(); // Restaura visual
                    return;
                }
                
                // Salva no sistema
                Sistema.Dados.definirFator(nome, this.dataVisualizada, valor);
                
                // Recarrega para aplicar os cálculos
                this.carregarTela();
            },

            selecionar: function(nome) {
                if (this.selecionado === nome) this.selecionado = null; 
                else this.selecionado = nome;
                this.renderizar();
            },

            limparSelecao: function() {
                this.selecionado = null;
                this.renderizar();
            },

            renderizar: function() {
                const tbody = document.getElementById('tabela-corpo'); tbody.innerHTML = '';
                
                // Filtra quem conta para a média (dias > 0)
                const ativos = this.listaAtual.filter(u => !u.inativo);
                
                const baseCalculo = this.selecionado 
                    ? this.listaAtual.filter(u => u.nome === this.selecionado) 
                    : ativos;

                const totalProd = baseCalculo.reduce((a, b) => a + b.total, 0);
                const totalMeta = baseCalculo.reduce((a, b) => a + b.meta, 0);
                const totalDias = baseCalculo.reduce((a, b) => a + b.dias, 0); 
                
                const mediaReal = totalDias ? Math.round(totalProd / totalDias) : 0;
                const mediaMeta = totalDias ? Math.round(totalMeta / totalDias) : 650;

                // Atualiza Cards
                document.getElementById('kpi-hc').innerText = this.selecionado ? "1" : ativos.length;
                document.getElementById('kpi-dias').innerText = totalDias;
                document.getElementById('kpi-dias-label').innerText = this.selecionado ? "Dias do Colaborador" : "Total Dias Equipe";
                
                document.getElementById('kpi-total').innerText = totalProd.toLocaleString();
                document.getElementById('kpi-meta-total').innerText = totalMeta.toLocaleString();
                document.getElementById('bar-prod').style.width = Math.min((totalProd/(totalMeta||1))*100, 100) + '%';

                document.getElementById('kpi-media').innerText = mediaReal.toLocaleString();
                document.getElementById('kpi-meta-media').innerText = mediaMeta.toLocaleString();
                document.getElementById('bar-media').style.width = Math.min((mediaReal/(mediaMeta||1))*100, 100) + '%';

                const selHeader = document.getElementById('selection-header');
                const selName = document.getElementById('selected-name');
                if (this.selecionado) {
                    selHeader.classList.remove('hidden');
                    selName.innerText = this.selecionado;
                } else {
                    selHeader.classList.add('hidden');
                }

                if(this.listaAtual.length === 0) { tbody.innerHTML = '<tr><td colspan="9" class="text-center py-10 text-slate-400">Sem dados.</td></tr>'; return; }

                this.listaAtual.forEach(u => {
                    const isSelected = this.selecionado === u.nome;
                    const rowClass = isSelected ? "selected-row" : "hover:bg-slate-50";
                    
                    // Se estiver inativo (0 dias), fica opaco
                    const opacity = u.inativo ? "row-ignored" : "";
                    
                    const badge = u.atingiu ? '<span class="bg-emerald-100 text-emerald-800 px-2 py-1 rounded text-xs font-bold">Atingida</span>' : '<span class="bg-rose-100 text-rose-800 px-2 py-1 rounded text-xs font-bold">Abaixo</span>';
                    
                    const subIds = u.ids.length > 1 ? `<br><span class="text-[9px] text-slate-400">IDs: ${u.ids.join(', ')}</span>` : '';

                    // Lógica para determinar qual opção do select marcar (com base nos dias calculados)
                    // Se for dia único, u.dias será 1, 0.5 ou 0.
                    // Se for período, u.dias será a soma. O select só faz sentido no modo DIÁRIO.
                    // Mas para exibir, tentamos inferir.
                    let fator = 1;
                    if (u.dias === 0) fator = 0;
                    else if (u.dias === 0.5) fator = 0.5;
                    
                    const fatorClass = fator === 1 ? 'st-1' : (fator === 0.5 ? 'st-05' : 'st-0');

                    // Select
                    const selectHtml = `
                        <select class="status-select ${fatorClass}" onclick="event.stopPropagation()" onchange="Geral.mudarFator('${u.nome}', this.value)">
                            <option value="1" ${fator===1?'selected':''}>100%</option>
                            <option value="0.5" ${fator===0.5?'selected':''}>50%</option>
                            <option value="0" ${fator===0?'selected':''}>0%</option>
                        </select>
                    `;

                    tbody.innerHTML += `
                    <tr class="${rowClass} ${opacity} transition border-b border-slate-100 cursor-pointer">
                        <td class="px-4 py-4 text-center">${selectHtml}</td>
                        <td class="px-6 py-4 font-bold text-slate-700" onclick="Geral.selecionar('${u.nome}')">
                            ${u.nome} ${subIds}
                        </td>
                        <td class="px-6 py-4 text-center text-slate-500">${u.dias}</td>
                        <td class="px-6 py-4 text-center font-bold text-blue-700">${u.total.toLocaleString()}</td>
                        <td class="px-6 py-4 text-center text-slate-600">${u.fifo}</td>
                        <td class="px-6 py-4 text-center text-slate-600">${u.gt}</td>
                        <td class="px-6 py-4 text-center text-slate-600">${u.gp}</td>
                        <td class="px-6 py-4 text-center text-slate-400">${u.meta.toLocaleString()}</td>
                        <td class="px-6 py-4 text-center">${badge}</td>
                    </tr>`;
                });
            }
        };

        // --- PLACEHOLDERS PARA AS OUTRAS ABAS (Performance, Matriz, Consolidado) ---
        // (Use os códigos anteriores completos destas constantes aqui. Resumidos para brevidade da resposta)
        const Perf = { init: function(){ this.carregarRanking(); }, carregarRanking: async function(){}, limparSelecao: function(){}, toggleUsuario: function(){}, renderRanking: function(){}, atualizarCards: function(){} };
        const Matriz = { init: function(){ this.carregar(); }, carregar: async function(){} };
        const Cons = { init: function(){ this.carregar(); }, carregar: async function(){} };

        // --- INICIALIZAÇÃO ---
        document.addEventListener('DOMContentLoaded', async () => {
            Sistema.Datas.criarInputInteligente('data-validacao', KEY_DATA_GLOBAL, Geral.carregarTela);
            await Sistema.Dados.inicializar(); 
            Geral.carregarTela();
        });
    </script>
</body>
</html>